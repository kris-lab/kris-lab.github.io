<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Wowza powered by M3 and G2 instances on AWS ? - __Chris_Stasiak__</title><meta name="description" content="This blogpost is continuation of ffmpeg/ffserver network latency benchmark. Today, I will focus on delay introduced by Wowza. As the previous blogpost showed the source of the delivery delay which is not the network latency but rather the computation itself&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://blog.kris-lab.com/wowza-powered-by-m3-and-g2-instances-on-aws-31/"><link rel="alternate" type="application/atom+xml" href="https://blog.kris-lab.com/feed.xml"><link rel="alternate" type="application/json" href="https://blog.kris-lab.com/feed.json"><meta property="og:title" content="Wowza powered by M3 and G2 instances on AWS ?"><meta property="og:site_name" content="__Chris_Stasiak__"><meta property="og:description" content="This blogpost is continuation of ffmpeg/ffserver network latency benchmark. Today, I will focus on delay introduced by Wowza. As the previous blogpost showed the source of the delivery delay which is not the network latency but rather the computation itself&hellip;"><meta property="og:url" content="https://blog.kris-lab.com/wowza-powered-by-m3-and-g2-instances-on-aws-31/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@_krislab"><meta name="twitter:title" content="Wowza powered by M3 and G2 instances on AWS ?"><meta name="twitter:description" content="This blogpost is continuation of ffmpeg/ffserver network latency benchmark. Today, I will focus on delay introduced by Wowza. As the previous blogpost showed the source of the delivery delay which is not the network latency but rather the computation itself&hellip;"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://blog.kris-lab.com/assets/css/style.css?v=942a7248764f7bd78c8eab338e2f678a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kris-lab.com/wowza-powered-by-m3-and-g2-instances-on-aws-31/"},"headline":"Wowza powered by M3 and G2 instances on AWS ?","datePublished":"2015-05-29T15:01","dateModified":"2020-08-26T12:15","description":"This blogpost is continuation of ffmpeg/ffserver network latency benchmark. Today, I will focus on delay introduced by Wowza. As the previous blogpost showed the source of the delivery delay which is not the network latency but rather the computation itself&hellip;","author":{"@type":"Person","name":"Chris Stasiak"},"publisher":{"@type":"Organization","name":"Chris Stasiak"}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-176563351-1"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176563351-1');</script></head><body><header class="header" id="js-header"><a href="https://blog.kris-lab.com/" class="logo">__Chris_Stasiak__</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="home-button"><a href="https://blog.kris-lab.com" target="_self">{ home }</a></li><li class="has-submenu"><a href="https://blog.kris-lab.com/" target="_self" aria-haspopup="true">#tagged</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://blog.kris-lab.com/tag/news/" target="_self">News</a></li><li><a href="https://blog.kris-lab.com/tag/devops-2/" target="_self">DevOps</a></li><li><a href="https://blog.kris-lab.com/tag/ffmpeg/" target="_self">Media</a></li><li><a href="https://blog.kris-lab.com/tag/vr/" target="_self">360/3D/VR</a></li><li><a href="https://blog.kris-lab.com/tag/artificial-intelligence-2/" target="_self">AI/ML/TPU</a></li><li><a href="https://blog.kris-lab.com/tag/tools/" target="_self">Tools</a></li></ul></li><li><a href="https://github.com/kris-lab" target="_blank">GitHub</a></li><li><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" target="_blank">LinkedIn</a></li><li><a href="https://keybase.io/krislab" target="_blank">Keybase</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">...</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://twitter.com/_krislab" target="_blank">Twitter</a></li><li><a href="https://www.vivino.com/users/krislab" target="_blank">Vivino</a></li><li><a href="https://you.23andme.com/published/reports/4ce9d90ae16a442590f1d3f8dcfd0eca/?share_id&#x3D;efcd35acba5a4f77" target="_blank">23andMe</a></li></ul></li><li class="line-vertical-separator"><span class="is-separator">|</span></li><li class="has-submenu"><a href="https://blog.kris-lab.com/contact/" target="_self" aria-haspopup="true">About</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://blog.kris-lab.com/contact/" target="_self">Contact</a></li><li><a href="https://blog.kris-lab.com/resume/" target="_self">Resume</a></li><li><a href="https://blog.kris-lab.com/references/" target="_self">References</a></li><li><a href="https://blog.kris-lab.com/gallery/" target="_self">Gallery</a></li><li class="line-horizontal-separator"><span class="is-separator">-</span></li><li><a href="https://blog.kris-lab.com/legal/" target="_self">Legal</a></li></ul></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><form action="https://blog.kris-lab.com/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" aria-label="Search input" placeholder="search..." autofocus="autofocus"> <button class="search__submit">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false" height="18" width="18"><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://blog.kris-lab.com/tag/benchmark/" class="post__maintag">benchmark</a><h1 class="post__title">Wowza powered by M3 and G2 instances on AWS ?</h1><div class="post__meta"><div class="post__author">By <a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" rel="author" title="Chris Stasiak">Chris Stasiak</a></div><time datetime="2015-05-29T15:01">May 29, 2015</time><div class="post__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/wowza-powered-by-m3-and-g2-instances-on-aws-31/#comments" data-disqus-identifier="870" class="invert" rel="nofollow">0</a></div></div></header><div class="post__inner"><div class="post__entry"><p>This blogpost is continuation of <a href="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24/">ffmpeg/ffserver network latency benchmark</a>.</p><p>Today, I will focus on delay introduced by Wowza. As the previous blogpost showed the source of the delivery delay which is not the network latency but rather the computation itself I will try to explain how to reduce that waste of the time. At he beginning we have to find what exactly does cause the delay. After deeper research I have found what follow:</p><ul><li>transcoding to multiple video/audio formats</li><li>synchronising for KEYFRAME inserts</li></ul><p>are currently the biggest issues in my opinion. Each stream can be transcoded into multiple formats in parallel but there is a need for synchronisation on some point which make the whole process very complex. Synchronisation is done mainly by KEYFRAMEs for better support of e.g. SMIL (Synchronised Multimedia Integration Language) which allows you to switch streams more fluently on the player side.</p><p>Even if the lower resolution streams are transformed very fast, there are HD, full HD streams which introduce high <strong>delay</strong>. So the question is for the lowest limit of that delay?Â I will compare computation on AWS instances of type <strong>M3</strong> and <strong>G2</strong>. The difference is basically in GPU (Graphic Processing Unit) which is dedicated hardware for extremely fast processing in parallel. This days it is used commonly in many areas of game, medical and science industry. Fortunately, there is a possibility to launch such instances on AWS!</p><p><strong>Workflow</strong></p><p>My benchmark depends and is achieved by adding timestamps to the video frames on the delivery way between publisher and subscriber. There are checkpoints for marking publish-time, play-time and computation marker for time compensation used during the stream processing.</p><figure class="aligncenter"><img loading="lazy" src="https://blog.kris-lab.com/media/posts/870/GrT2ucLzqTjoasF0UvpPPC1opuKbEnRo2fQLzQa4U7d9aXy8MmAjupWmy-gIvyjiaDJHkBfL1NKoPGk49DoDnLoATkx41U-zjHGJi_wGQ_FdtjdDT7wRrvb0htpllgF-h2vhtfA" alt="" width="890px;" height="1317px;"></figure><p><strong>Wowza on m3.2xlarge/aws</strong></p><p>No transcoder, origin stream</p><p><img loading="lazy" src="https://blog.kris-lab.com/media/posts/870/7CyV2FmckKR1XPtRUQ-0WrhK-tKzzQS6FJLWhDmH8ch2QGuYYXmD5aDgQSRwRrLBPl-o_EMFDpn_w-wEY-IxD860xZh31uGhSpXPSdMTvxOgSRcUDZ64Y4Njyg5ozuKj4Zo31_Q" alt="" width="754px;" height="651px;"></p><h4 style="text-align: center;"><strong>58.88-56.37-(56.37-55.22)-(58.88-57.83) = 310ms</strong></h4><p>With transcoder, origin stream</p><p><img loading="lazy" src="https://blog.kris-lab.com/media/posts/870/7CyV2FmckKR1XPtRUQ-0WrhK-tKzzQS6FJLWhDmH8ch2QGuYYXmD5aDgQSRwRrLBPl-o_EMFDpn_w-wEY-IxD860xZh31uGhSpXPSdMTvxOgSRcUDZ64Y4Njyg5ozuKj4Zo31_Q" alt="" width="754px;" height="651px;"></p><h4 style="text-align: center;">40.69-37.93-(40.69-39.84)-(37.93-36.73)= 710ms</h4><p>With transcoder, passthrough mode</p><p><img loading="lazy" src="https://blog.kris-lab.com/media/posts/870/Yj8TZcJB4IZD5lbb1Mx4zak1PL43CqdH2CMaAqt2H-5ruAGlu658aRo-m35lL0kaJcppTtAUvED7ZbS9o7_mxxeRb4YeCdr7yh8Zo5qAgHITxprfd3N0ezmL14ScoRNPjhB-ak4" alt="" width="757px;" height="653px;"></p><h4 style="text-align: center;">39.87-35.31-(39.87-38.92)-(35.31-34.15)= 2100ms = 2.1s</h4><p>Basically adding more and more complexity we slow down the whole workflow (presented timing could be improved by default for wowza; I want to show the problem itself). This behaviour is pretty obvious but how could we prevent that?</p><p>This is why I did the next test using GPU, powered by AWS G2 instance. <span style="font-size: 18px;">Please check for the next blogpost where I will share some G2 data and steps you could run your own instances...</span></p><p><a href="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24/">You can find some useful publisher and subscriber ffmpeg CLI tips here</a>.</p></div><footer><p class="post__last-updated">This article was updated on August 26, 2020</p><div class="post__tags-share"><ul class="post__tag"><li><a href="https://blog.kris-lab.com/tag/aws/">AWS</a></li><li><a href="https://blog.kris-lab.com/tag/benchmark/">benchmark</a></li><li><a href="https://blog.kris-lab.com/tag/ffmpeg/">ffmpeg</a></li><li><a href="https://blog.kris-lab.com/tag/g2-aws/">g2.aws</a></li><li><a href="https://blog.kris-lab.com/tag/gpu/">GPU</a></li><li><a href="https://blog.kris-lab.com/tag/live-streaming/">live streaming</a></li><li><a href="https://blog.kris-lab.com/tag/m3-aws/">m3.aws</a></li><li><a href="https://blog.kris-lab.com/tag/nvidia/">nvidia</a></li><li><a href="https://blog.kris-lab.com/tag/parallel-computing/">parallel computing</a></li><li><a href="https://blog.kris-lab.com/tag/rtmp/">RTMP</a></li><li><a href="https://blog.kris-lab.com/tag/smil/">SMIL</a></li><li><a href="https://blog.kris-lab.com/tag/streaming/">streaming</a></li><li><a href="https://blog.kris-lab.com/tag/transcoder/">transcoder</a></li><li><a href="https://blog.kris-lab.com/tag/transrate/">transrate</a></li><li><a href="https://blog.kris-lab.com/tag/workflow/">workflow</a></li><li><a href="https://blog.kris-lab.com/tag/wowza-2/">wowza</a></li></ul><aside class="post__share"><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.kris-lab.com%2Fwowza-powered-by-m3-and-g2-instances-on-aws-31%2F&amp;via=%40_krislab&amp;text=Wowza%20powered%20by%20M3%20and%20G2%20instances%20on%20AWS%20%3F" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fblog.kris-lab.com%2Fwowza-powered-by-m3-and-g2-instances-on-aws-31%2F&amp;media=undefined&amp;description=Wowza%20powered%20by%20M3%20and%20G2%20instances%20on%20AWS%20%3F" class="js-share pinterest" aria-label="Share with Pinterest" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.kris-lab.com%2Fwowza-powered-by-m3-and-g2-instances-on-aws-31%2F&amp;title=Wowza%20powered%20by%20M3%20and%20G2%20instances%20on%20AWS%20%3F" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=Wowza%20powered%20by%20M3%20and%20G2%20instances%20on%20AWS%20%3F&amp;url=https%3A%2F%2Fblog.kris-lab.com%2Fwowza-powered-by-m3-and-g2-instances-on-aws-31%2F" class="js-share buffer" aria-label="Share with Buffer" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#buffer"/></svg> </a><a href="https://api.whatsapp.com/send?text=Wowza%20powered%20by%20M3%20and%20G2%20instances%20on%20AWS%20%3F https%3A%2F%2Fblog.kris-lab.com%2Fwowza-powered-by-m3-and-g2-instances-on-aws-31%2F" class="js-share whatsapp" aria-label="Share with WhatsApp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#whatsapp"/></svg></a></aside></div><div class="post__bio author"><div><h3 class="h6 author__name"><a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" title="Chris Stasiak">Chris Stasiak</a></h3></div></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://blog.kris-lab.com/weather-in-terminal-3/" rel="prev">Previous Post<h3 class="h6">Weather in Terminal</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://blog.kris-lab.com/wowza-powered-by-nvidia-gpu-on-aws-5/" rel="prev">Next Post<h3 class="h6">Wowza powered by Nvidia GPU on AWS</h3></a></div></nav></footer></div></article><div class="comments post__inner" id="comments"><h3 class="h5">Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                    this.page.url = '';
            		this.page.identifier = '';
                };
            
                var disqus_loaded = false;
            
                function publiiLoadDisqus() {
                    if(disqus_loaded) {
                        return false;
                    }
            
                    var top = document.getElementById('disqus_thread').offsetTop;
            
                    if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                        disqus_loaded = true;
            
                        (function () {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://blog-kris-lab-com.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    }
                }
            
                publiiLoadDisqus();
            
                window.onscroll = function() {
                    publiiLoadDisqus();
                };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="post__related"><div class="wrapper"><h2 class="h5">Related posts</h2><div class="l-grid l-grid--4"><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/audio-2/">audio</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24/" class="invert">Video streaming benchmark with ffmpeg, ffserver, wowza...</a></h3></header><p class="c-card__text">I had a chance for deep research and test of video/audio streaming techniques. My testing stack is based on Wowza which worked good enough for simple solutions. I have decided to extend that model so there was a need to&hellip;</p><footer class="c-card__meta"><time datetime="2015-05-26T20:22">May 26, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24/#post-comments" data-disqus-identifier="878" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/avfoundation/">avfoundation</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/simple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24/" class="invert">Simple OSX bi-directional video chat using ffmpeg, ffplay and wowza</a></h3></header><p class="c-card__text">In this blogpost I will try to present how to set up a very simple video chat application for 2 users. I will call them Chris and John for simplicity. In short, each of them will publish the video and&hellip;</p><footer class="c-card__meta"><time datetime="2015-06-01T08:26">June 1, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/simple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24/#post-comments" data-disqus-identifier="869" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/devops-2/">devops</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/wowza-powered-by-nvidia-gpu-on-aws-5/" class="invert">Wowza powered by Nvidia GPU on AWS</a></h3></header><p class="c-card__text">This blogpost is continuation of Wowza powered by M3 and G2 instances on AWS. GPU is absolutely awesome piece of engineering. It extremely speed up computation which can be parallelized. Media transformation is that case. If we need to transcode&hellip;</p><footer class="c-card__meta"><time datetime="2015-05-31T15:22">May 31, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/wowza-powered-by-nvidia-gpu-on-aws-5/#post-comments" data-disqus-identifier="720" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/research/">research</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/osx-low-latency-ffmpeg-plublisher-with-ffplay-subscriber-via-wowza-streaming-engine-3/" class="invert">OSX low latency ffmpeg publisher with ffplay subscriber via wowza streaming engine</a></h3></header><p class="c-card__text">ffmpeg -f avfoundation -list_devices true -i ""[AVFoundation input device @ 0x7f88b0422800] AVFoundation video devices:[AVFoundation input device @ 0x7f88b0422800] [0] FaceTime HD Camera[AVFoundation input device @ 0x7f88b0422800] [1] Capture screen 0[AVFoundation input device @ 0x7f88b0422800] AVFoundation audio devices:[AVFoundation input device @&hellip;</p><footer class="c-card__meta"><time datetime="2015-06-01T22:38">June 1, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/osx-low-latency-ffmpeg-plublisher-with-ffplay-subscriber-via-wowza-streaming-engine-3/#post-comments" data-disqus-identifier="718" class="invert" rel="nofollow">0</a></div></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://twitter.com/_krislab" aria-label="Twitter" class="twitter"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/_krislab" aria-label="Instagram" class="instagram"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" aria-label="LinkedIn" class="linkedin"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">&copy; 2020 Krzysztof Stasiak</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://blog.kris-lab.com/assets/js/scripts.min.js?v=8b3e67b51e8c7a7d51b33f4a94ae4287"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script><script id="dsq-count-scr" src="https://blog-kris-lab-com.disqus.com/count.js" async></script></body></html>