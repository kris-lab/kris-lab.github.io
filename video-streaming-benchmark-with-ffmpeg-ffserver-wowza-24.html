<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Video streaming benchmark with ffmpeg, ffserver, wowza... - Chris Stasiak</title><meta name="description" content="I had a chance for deep research and test of video/audio streaming techniques. My testing stack is based on Wowza&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24.html"><link rel="alternate" type="application/atom+xml" href="https://blog.kris-lab.com/feed.xml"><link rel="alternate" type="application/json" href="https://blog.kris-lab.com/feed.json"><meta property="og:title" content="Video streaming benchmark with ffmpeg, ffserver, wowza..."><meta property="og:site_name" content="Chris Stasiak"><meta property="og:description" content="I had a chance for deep research and test of video/audio streaming techniques. My testing stack is based on Wowza&hellip;"><meta property="og:url" content="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24.html"><meta property="og:type" content="article"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://blog.kris-lab.com/assets/css/style.css?v=1e8049a2db15bde18056c70a364c486d"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24.html"},"headline":"Video streaming benchmark with ffmpeg, ffserver, wowza...","datePublished":"2015-05-26T19:22","dateModified":"2020-08-25T22:41","description":"I had a chance for deep research and test of video/audio streaming techniques. My testing stack is based on Wowza&hellip;","author":{"@type":"Person","name":"Chris Stasiak"},"publisher":{"@type":"Organization","name":"Chris Stasiak"}}</script></head><body><header class="header" id="js-header"><a href="https://blog.kris-lab.com/" class="logo">Chris Stasiak</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">[MISSING TRANSLATION]</span></span></button><ul class="navbar__menu"><li class="home-button"><a href="https://blog.kris-lab.com" target="_self">{ home }</a></li><li class="has-submenu"><a href="https://blog.kris-lab.com/" target="_self" aria-haspopup="true">#tagged</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://blog.kris-lab.com/vr/" target="_self">360/3D/VR</a></li><li><a href="https://blog.kris-lab.com/wowza-2/" target="_self">Media</a></li><li><a href="https://blog.kris-lab.com/artificial-intelligence-2/" target="_self">AI/ML/TPU</a></li><li><a href="https://blog.kris-lab.com/devops-2/" target="_self">DevOps</a></li></ul></li><li><a href="https://github.com/kris-lab" target="_blank">GitHub</a></li><li><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" target="_blank">LinkedIn</a></li><li><a href="https://keybase.io/krislab" target="_blank">Keybase</a></li><li><a href="https://twitter.com/_krislab" target="_blank">Twitter</a></li><li><a href="https://blog.kris-lab.com/contact.html" target="_self">Contact</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><form action="https://blog.kris-lab.com/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" aria-label="Search text" placeholder="search..." autofocus="autofocus"> <button class="search__submit">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false" height="18" width="18"><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://blog.kris-lab.com/audio-2/" class="post__maintag">audio</a><h1 class="post__title">Video streaming benchmark with ffmpeg, ffserver, wowza...</h1><div class="post__meta"><div class="post__author">By <a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" rel="author" title="Chris Stasiak">Chris Stasiak</a></div><time datetime="2015-05-26T19:22">May 26, 2015</time></div></header><div class="post__inner"><div class="post__entry"><p>I had a chance for deep research and test of video/audio streaming techniques. My testing stack is based on Wowza which worked good enough for simple solutions. I have decided to extend that model so there was a need to research much deeper for techniques and find out the cutting-edge technology of this days...</p><p>I started with as basic as possible tooling. Ffmpeg, ffserver, ffplay combined with NTP (Network Time Protocol) is actually a very powerful toolset. I decided to go with AWS using 2 regions. North Virginia (US) for server instance and Ireland (EU) for clients.</p><p>The workflow looks like follows:</p><figure class="aligncenter"><a href="https://blog.kris-lab.com/media/posts/878/VOD2glDGodkaP2H9yO_rXFZYmwDXqExVHNbsHRWaf2LY9MZmFjKPlGpNrxxV5oO_QE1iCIqX7dQRnxheAlq3JJVX4p-DkH_l09nPd7kLwIOakkLdq-HBBYR8HYzIbJ7DCcGGAFY" target="_blank" rel="noopener"><img loading="lazy" src="https://blog.kris-lab.com/media/posts/878/VOD2glDGodkaP2H9yO_rXFZYmwDXqExVHNbsHRWaf2LY9MZmFjKPlGpNrxxV5oO_QE1iCIqX7dQRnxheAlq3JJVX4p-DkH_l09nPd7kLwIOakkLdq-HBBYR8HYzIbJ7DCcGGAFY" alt="" width="938px;" height="960px;"></a></figure><p></p><p>So the test is basically about transatlantic streaming of video via ffmpeg/ffserver pipes which add the timestamps on the way. It helps for pretty accurate calculation of network latency which is introduced on each stage. Some of timestamp are introduced for calculating the computation offset and to compensate this delay in final result.</p><figure class="aligncenter"><strong>Sample</strong> <strong>and network latency estimation</strong><img loading="lazy" src="https://blog.kris-lab.com/media/posts/878/V9w0P2FHtKn4qZhHqt6QL0cmvXICV8kuM9H3QQ7Wryd-61espL5HGDV8N94JKCx8EXQ6RsllvJ746aOmgo1n1k8obNxuYc1mWLIdy1otO4-hi6loKtWBciRmXYqR3xba_WTlCbg" alt="" width="624px;" height="536px;"></figure><p>The calculations (using last 5 digits XXX.XX)<br>T1 = 697.96<br>T2 = 698.86<br>T3 = 700.18</p><p> </p><h4 style="text-align: center;"><strong>Point_To_Point_Time = T3-T2 - (T2-T1) = 420ms</strong></h4><p> </p><p>The best result I could currently achieve was <strong>200ms</strong>. This is pretty good achievement, considering transatlantic delay which is ~75ms and the cloud computation delay...</p><p><strong>Streamer</strong> command</p><pre>ffmpeg -i your-file.mp4 -tune zerolatency -filter:v "setpts=1.0*PTS" -f nut pipe:1 \\
| ffmpeg -re -i pipe:0 -vf "drawtext=expansion=normal:fontfile=/usr/share/fonts/truetype/ttf-dejavu/DejaVuSans.ttf:reload=1:textfile=test.txt: x=50: y=50: fontcolor=white" -tune zerolatency -f nut pipe:1 \\
| ffmpeg -y -i pipe:0 -tune zerolatency http://ffserver-ip:7000/feed1.ffm</pre><p><strong>Player</strong> commands</p><pre>ffmpeg -rtsp_transport tcp -i rtsp://ffserver-ip:8544/live.mp4  -tune zerolatency -vf "drawtext=expansion=normal:fontfile=/usr/share/fonts/truetype/ttf-dejavu/DejaVuSans.ttf:reload=1:textfile=test.txt: x=50: y=70: fontcolor=white" output.mp4</pre><p><strong>Server </strong>configuration you can find <a href="https://gist.github.com/kris-lab/28060a51c122b4da08b9" target="_blank" rel="noopener">here</a></p><p>The <strong>Timestamp</strong> which is drawn on the each frame is read from file test.txt. This file is updated by external python process using script you can find <a href="https://gist.github.com/kris-lab/28060a51c122b4da08b9" target="_blank" rel="noopener">here</a> as well.</p><p>I deployed the infrastructure using <a href="http://www.terraform.io/" target="_blank" rel="noopener">Terraform</a> but obviously this is not the important part. You can use any deployment tool or even do it manually.</p><p><strong>Wowza approach (draft)</strong></p><p><a href="https://blog.kris-lab.com/media/posts/878/NuANF6O8hyrnIAQaiYdKHvUUgTejdEsnKBLvcPpHFQ2LZw5gZlb2XdwsPUsOTmjnzprimSv0RB1TTkOUBCVz7BroNlzElzDNUjq0b7Yc_cY9rxgw6BjASLMna3Ayrd-3CoiRRTk" target="_blank" rel="noopener"><img loading="lazy" src="https://blog.kris-lab.com/media/posts/878/NuANF6O8hyrnIAQaiYdKHvUUgTejdEsnKBLvcPpHFQ2LZw5gZlb2XdwsPUsOTmjnzprimSv0RB1TTkOUBCVz7BroNlzElzDNUjq0b7Yc_cY9rxgw6BjASLMna3Ayrd-3CoiRRTk" alt="" width="955px;" height="1046px;"></a></p><p>This is draft of upcoming test. Will elaborate in next blogpost...</p><p>Hope this is helpful for you. Good luck!</p></div><footer><p class="post__last-updated">This article was updated on August 25, 2020</p><div class="post__tags-share"><ul class="post__tag"><li><a href="https://blog.kris-lab.com/audio-2/">audio</a></li><li><a href="https://blog.kris-lab.com/aws/">AWS</a></li><li><a href="https://blog.kris-lab.com/benchmark/">benchmark</a></li><li><a href="https://blog.kris-lab.com/drawtext/">drawtext</a></li><li><a href="https://blog.kris-lab.com/ffmpeg/">ffmpeg</a></li><li><a href="https://blog.kris-lab.com/ffserver/">ffserver</a></li><li><a href="https://blog.kris-lab.com/streaming/">streaming</a></li><li><a href="https://blog.kris-lab.com/terraform/">terraform</a></li><li><a href="https://blog.kris-lab.com/video-2/">video</a></li><li><a href="https://blog.kris-lab.com/wowza-2/">wowza</a></li></ul><aside class="post__share"><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.kris-lab.com%2Fvideo-streaming-benchmark-with-ffmpeg-ffserver-wowza-24.html&amp;via=%40_krislab&amp;text=Video%20streaming%20benchmark%20with%20ffmpeg%2C%20ffserver%2C%20wowza..." class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.kris-lab.com%2Fvideo-streaming-benchmark-with-ffmpeg-ffserver-wowza-24.html&amp;title=Video%20streaming%20benchmark%20with%20ffmpeg%2C%20ffserver%2C%20wowza..." class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=Video%20streaming%20benchmark%20with%20ffmpeg%2C%20ffserver%2C%20wowza...&amp;url=https%3A%2F%2Fblog.kris-lab.com%2Fvideo-streaming-benchmark-with-ffmpeg-ffserver-wowza-24.html" class="js-share buffer" aria-label="Share with Buffer" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#buffer"/></svg></a></aside></div><div class="post__bio author"><div><h3 class="h6 author__name"><a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" title="Chris Stasiak">Chris Stasiak</a></h3></div></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://blog.kris-lab.com/pushing-your-meteor-project-to-heroku.html" rel="prev">Previous Post<h3 class="h6">Pushing Your Meteor Project to Heroku</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://blog.kris-lab.com/ffmpeg-ffserver-ffplay-wowza-for-video-streaming-benchmark.html" rel="prev">Next Post<h3 class="h6">ffmpeg, ffserver, ffplay, wowza for video streaming benchmark</h3></a></div></nav></footer></div></article></div><div class="post__related"><div class="wrapper"><h3 class="h5">Related posts</h3><div class="l-grid l-grid--4"><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/avfoundation/">avfoundation</a></div><h2 class="c-card__title"><a href="https://blog.kris-lab.com/simple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24.html" class="invert">Simple OSX bi-directional video chat using ffmpeg, ffplay and wowza</a></h2></header><footer class="c-card__meta"><time datetime="2015-06-01T07:26">June 1, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/simple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24.html#post-comments" data-disqus-identifier="869" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/artificial-intelligence-2/">artificial intelligence</a></div><h2 class="c-card__title"><a href="https://blog.kris-lab.com/intelligent-content-streaming-engine-icse-part-1-introduction-51.html" class="invert">Intelligent Content Streaming Engine (ICSE) - Part 1 / Introduction</a></h2></header><footer class="c-card__meta"><time datetime="2015-05-04T19:40">May 4, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/intelligent-content-streaming-engine-icse-part-1-introduction-51.html#post-comments" data-disqus-identifier="865" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/api/">API</a></div><h2 class="c-card__title"><a href="https://blog.kris-lab.com/mongo-mms-api-agent-for-ruby-with-basic-cli-client-14.html" class="invert">Mongo MMS API agent for ruby with basic cli client</a></h2></header><footer class="c-card__meta"><time datetime="2014-08-28T07:06">August 28, 2014</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/mongo-mms-api-agent-for-ruby-with-basic-cli-client-14.html#post-comments" data-disqus-identifier="863" class="invert" rel="nofollow">0</a></div></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://twitter.com/_krislab" aria-label="Twitter" class="twitter"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/_krislab" aria-label="Instagram" class="instagram"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" aria-label="LinkedIn" class="linkedin"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">&copy; 2020 Powered by Publii Static CMS</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://blog.kris-lab.com/assets/js/scripts.min.js?v=8b3e67b51e8c7a7d51b33f4a94ae4287"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>