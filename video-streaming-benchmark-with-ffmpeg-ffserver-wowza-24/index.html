<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Video streaming benchmark with ffmpeg, ffserver, wowza... - __Chris_Stasiak__</title><meta name="description" content="I had a chance for deep research and test of video/audio streaming techniques. My testing stack is based on Wowza which worked good enough for simple solutions. I have decided to extend that model so there was a need to&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24/"><link rel="alternate" type="application/atom+xml" href="https://blog.kris-lab.com/feed.xml"><link rel="alternate" type="application/json" href="https://blog.kris-lab.com/feed.json"><meta property="og:title" content="Video streaming benchmark with ffmpeg, ffserver, wowza..."><meta property="og:site_name" content="__Chris_Stasiak__"><meta property="og:description" content="I had a chance for deep research and test of video/audio streaming techniques. My testing stack is based on Wowza which worked good enough for simple solutions. I have decided to extend that model so there was a need to&hellip;"><meta property="og:url" content="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@_krislab"><meta name="twitter:title" content="Video streaming benchmark with ffmpeg, ffserver, wowza..."><meta name="twitter:description" content="I had a chance for deep research and test of video/audio streaming techniques. My testing stack is based on Wowza which worked good enough for simple solutions. I have decided to extend that model so there was a need to&hellip;"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://blog.kris-lab.com/assets/css/style.css?v=942a7248764f7bd78c8eab338e2f678a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24/"},"headline":"Video streaming benchmark with ffmpeg, ffserver, wowza...","datePublished":"2015-05-26T20:22","dateModified":"2020-10-21T23:15","description":"I had a chance for deep research and test of video/audio streaming techniques. My testing stack is based on Wowza which worked good enough for simple solutions. I have decided to extend that model so there was a need to&hellip;","author":{"@type":"Person","name":"Chris Stasiak"},"publisher":{"@type":"Organization","name":"Chris Stasiak"}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-176563351-1"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176563351-1');</script></head><body><header class="header" id="js-header"><a href="https://blog.kris-lab.com/" class="logo">__Chris_Stasiak__</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="home-button"><a href="https://blog.kris-lab.com" target="_self">{ home }</a></li><li class="has-submenu"><a href="https://blog.kris-lab.com/" target="_self" aria-haspopup="true">#tagged</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://blog.kris-lab.com/tag/news/" target="_self">News</a></li><li><a href="https://blog.kris-lab.com/tag/devops-2/" target="_self">DevOps</a></li><li><a href="https://blog.kris-lab.com/tag/ffmpeg/" target="_self">Media</a></li><li><a href="https://blog.kris-lab.com/tag/vr/" target="_self">360/3D/VR</a></li><li><a href="https://blog.kris-lab.com/tag/artificial-intelligence-2/" target="_self">AI/ML/TPU</a></li></ul></li><li><a href="https://github.com/kris-lab" target="_blank">GitHub</a></li><li><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" target="_blank">LinkedIn</a></li><li><a href="https://keybase.io/krislab" target="_blank">Keybase</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">...</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://twitter.com/_krislab" target="_blank">Twitter</a></li><li><a href="https://www.vivino.com/users/krislab" target="_blank">Vivino</a></li><li><a href="https://you.23andme.com/published/reports/4ce9d90ae16a442590f1d3f8dcfd0eca/?share_id&#x3D;efcd35acba5a4f77" target="_blank">23andMe</a></li></ul></li><li class="line-vertical-separator"><span class="is-separator">|</span></li><li class="has-submenu"><a href="https://blog.kris-lab.com/contact/" target="_self" aria-haspopup="true">About</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://blog.kris-lab.com/contact/" target="_self">Contact</a></li><li><a href="https://blog.kris-lab.com/resume/" target="_self">Resume</a></li><li><a href="https://blog.kris-lab.com/references/" target="_self">References</a></li><li><a href="https://blog.kris-lab.com/gallery/" target="_self">Gallery</a></li><li class="line-horizontal-separator"><span class="is-separator">-</span></li><li><a href="https://blog.kris-lab.com/legal/" target="_self">Legal</a></li></ul></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><form action="https://blog.kris-lab.com/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" aria-label="Search input" placeholder="search..." autofocus="autofocus"> <button class="search__submit">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false" height="18" width="18"><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://blog.kris-lab.com/tag/audio-2/" class="post__maintag">audio</a><h1 class="post__title">Video streaming benchmark with ffmpeg, ffserver, wowza...</h1><div class="post__meta"><div class="post__author">By <a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" rel="author" title="Chris Stasiak">Chris Stasiak</a></div><time datetime="2015-05-26T20:22">May 26, 2015</time><div class="post__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24/#comments" data-disqus-identifier="878" class="invert" rel="nofollow">0</a></div></div></header><div class="post__inner"><div class="post__entry"><p>I had a chance for deep research and test of video/audio streaming techniques. My testing stack is based on Wowza which worked good enough for simple solutions. I have decided to extend that model so there was a need to research much deeper for techniques and find out the cutting-edge technology of this days...</p><p>I started with as basic as possible tooling. Ffmpeg, ffserver, ffplay combined with NTP (Network Time Protocol) is actually a very powerful toolset. I decided to go with AWS using 2 regions. North Virginia (US) for server instance and Ireland (EU) for clients.</p><p>The workflow looks like follows:</p><figure class="aligncenter"><a href="https://blog.kris-lab.com/media/posts/878/VOD2glDGodkaP2H9yO_rXFZYmwDXqExVHNbsHRWaf2LY9MZmFjKPlGpNrxxV5oO_QE1iCIqX7dQRnxheAlq3JJVX4p-DkH_l09nPd7kLwIOakkLdq-HBBYR8HYzIbJ7DCcGGAFY" target="_blank" rel="noopener"><img loading="lazy" src="https://blog.kris-lab.com/media/posts/878/VOD2glDGodkaP2H9yO_rXFZYmwDXqExVHNbsHRWaf2LY9MZmFjKPlGpNrxxV5oO_QE1iCIqX7dQRnxheAlq3JJVX4p-DkH_l09nPd7kLwIOakkLdq-HBBYR8HYzIbJ7DCcGGAFY" alt="" width="938px;" height="960px;"></a></figure><p></p><p>So the test is basically about transatlantic streaming of video via ffmpeg/ffserver pipes which add the timestamps on the way. It helps for pretty accurate calculation of network latency which is introduced on each stage. Some of timestamp are introduced for calculating the computation offset and to compensate this delay in final result.</p><figure class="aligncenter"><strong>Sample</strong> <strong>and network latency estimation</strong><img loading="lazy" src="https://blog.kris-lab.com/media/posts/878/V9w0P2FHtKn4qZhHqt6QL0cmvXICV8kuM9H3QQ7Wryd-61espL5HGDV8N94JKCx8EXQ6RsllvJ746aOmgo1n1k8obNxuYc1mWLIdy1otO4-hi6loKtWBciRmXYqR3xba_WTlCbg" alt="" width="624px;" height="536px;"></figure><p>The calculations (using last 5 digits XXX.XX)<br>T1 = 697.96<br>T2 = 698.86<br>T3 = 700.18</p><p> </p><h4 style="text-align: center;"><strong>Point_To_Point_Time = T3-T2 - (T2-T1) = 420ms</strong></h4><p> </p><p>The best result I could currently achieve was <strong>200ms</strong>. This is pretty good achievement, considering transatlantic delay which is ~75ms and the cloud computation delay...</p><p><strong>Streamer</strong> command</p><pre>ffmpeg -i your-file.mp4 -tune zerolatency -filter:v "setpts=1.0*PTS" -f nut pipe:1 \\
| ffmpeg -re -i pipe:0 -vf "drawtext=expansion=normal:fontfile=/usr/share/fonts/truetype/ttf-dejavu/DejaVuSans.ttf:reload=1:textfile=test.txt: x=50: y=50: fontcolor=white" -tune zerolatency -f nut pipe:1 \\
| ffmpeg -y -i pipe:0 -tune zerolatency http://ffserver-ip:7000/feed1.ffm</pre><p><strong>Player</strong> commands</p><pre>ffmpeg -rtsp_transport tcp -i rtsp://ffserver-ip:8544/live.mp4  -tune zerolatency -vf "drawtext=expansion=normal:fontfile=/usr/share/fonts/truetype/ttf-dejavu/DejaVuSans.ttf:reload=1:textfile=test.txt: x=50: y=70: fontcolor=white" output.mp4</pre><p><strong>Server </strong>configuration you can find <a href="https://gist.github.com/kris-lab/28060a51c122b4da08b9" target="_blank" rel="noopener">here</a></p><p>The <strong>Timestamp</strong> which is drawn on the each frame is read from file test.txt. This file is updated by external python process using script you can find <a href="https://gist.github.com/kris-lab/28060a51c122b4da08b9" target="_blank" rel="noopener">here</a> as well.</p><p>I deployed the infrastructure using <a href="http://www.terraform.io/" target="_blank" rel="noopener">Terraform</a> but obviously this is not the important part. You can use any deployment tool or even do it manually.</p><p><strong>Wowza approach (draft)</strong></p><p><a href="https://blog.kris-lab.com/media/posts/878/NuANF6O8hyrnIAQaiYdKHvUUgTejdEsnKBLvcPpHFQ2LZw5gZlb2XdwsPUsOTmjnzprimSv0RB1TTkOUBCVz7BroNlzElzDNUjq0b7Yc_cY9rxgw6BjASLMna3Ayrd-3CoiRRTk" target="_blank" rel="noopener"><img loading="lazy" src="https://blog.kris-lab.com/media/posts/878/NuANF6O8hyrnIAQaiYdKHvUUgTejdEsnKBLvcPpHFQ2LZw5gZlb2XdwsPUsOTmjnzprimSv0RB1TTkOUBCVz7BroNlzElzDNUjq0b7Yc_cY9rxgw6BjASLMna3Ayrd-3CoiRRTk" alt="" width="955px;" height="1046px;"></a></p><p>This is draft of upcoming test. Will elaborate in next blogpost...</p><p>Hope this is helpful for you. Good luck!</p></div><footer><p class="post__last-updated">This article was updated on October 21, 2020</p><div class="post__tags-share"><ul class="post__tag"><li><a href="https://blog.kris-lab.com/tag/audio-2/">audio</a></li><li><a href="https://blog.kris-lab.com/tag/aws/">AWS</a></li><li><a href="https://blog.kris-lab.com/tag/benchmark/">benchmark</a></li><li><a href="https://blog.kris-lab.com/tag/drawtext/">drawtext</a></li><li><a href="https://blog.kris-lab.com/tag/ffmpeg/">ffmpeg</a></li><li><a href="https://blog.kris-lab.com/tag/ffserver/">ffserver</a></li><li><a href="https://blog.kris-lab.com/tag/streaming/">streaming</a></li><li><a href="https://blog.kris-lab.com/tag/terraform/">terraform</a></li><li><a href="https://blog.kris-lab.com/tag/video-2/">video</a></li><li><a href="https://blog.kris-lab.com/tag/wowza-2/">wowza</a></li></ul><aside class="post__share"><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.kris-lab.com%2Fvideo-streaming-benchmark-with-ffmpeg-ffserver-wowza-24%2F&amp;via=%40_krislab&amp;text=Video%20streaming%20benchmark%20with%20ffmpeg%2C%20ffserver%2C%20wowza..." class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fblog.kris-lab.com%2Fvideo-streaming-benchmark-with-ffmpeg-ffserver-wowza-24%2F&amp;media=undefined&amp;description=Video%20streaming%20benchmark%20with%20ffmpeg%2C%20ffserver%2C%20wowza..." class="js-share pinterest" aria-label="Share with Pinterest" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.kris-lab.com%2Fvideo-streaming-benchmark-with-ffmpeg-ffserver-wowza-24%2F&amp;title=Video%20streaming%20benchmark%20with%20ffmpeg%2C%20ffserver%2C%20wowza..." class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=Video%20streaming%20benchmark%20with%20ffmpeg%2C%20ffserver%2C%20wowza...&amp;url=https%3A%2F%2Fblog.kris-lab.com%2Fvideo-streaming-benchmark-with-ffmpeg-ffserver-wowza-24%2F" class="js-share buffer" aria-label="Share with Buffer" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#buffer"/></svg> </a><a href="https://api.whatsapp.com/send?text=Video%20streaming%20benchmark%20with%20ffmpeg%2C%20ffserver%2C%20wowza... https%3A%2F%2Fblog.kris-lab.com%2Fvideo-streaming-benchmark-with-ffmpeg-ffserver-wowza-24%2F" class="js-share whatsapp" aria-label="Share with WhatsApp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#whatsapp"/></svg></a></aside></div><div class="post__bio author"><div><h3 class="h6 author__name"><a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" title="Chris Stasiak">Chris Stasiak</a></h3></div></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://blog.kris-lab.com/pushing-your-meteor-project-to-heroku/" rel="prev">Previous Post<h3 class="h6">Pushing Your Meteor Project to Heroku</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://blog.kris-lab.com/weather-in-terminal-3/" rel="prev">Next Post<h3 class="h6">Weather in Terminal</h3></a></div></nav></footer></div></article><div class="comments post__inner" id="comments"><h3 class="h5">Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                    this.page.url = '';
            		this.page.identifier = '';
                };
            
                var disqus_loaded = false;
            
                function publiiLoadDisqus() {
                    if(disqus_loaded) {
                        return false;
                    }
            
                    var top = document.getElementById('disqus_thread').offsetTop;
            
                    if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                        disqus_loaded = true;
            
                        (function () {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://blog-kris-lab-com.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    }
                }
            
                publiiLoadDisqus();
            
                window.onscroll = function() {
                    publiiLoadDisqus();
                };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="post__related"><div class="wrapper"><h2 class="h5">Related posts</h2><div class="l-grid l-grid--4"><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/news/">news</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/videochat-in-terminal-8/" class="invert">VideoChat in Terminal</a></h3></header><p class="c-card__text">Absolutely awesome application for P2P Video Chat, written in C++. Check it out on Github This is easy to compile on OSX and to start video chat in less than minute. Please follow instructions of github readme. Have fun!</p><footer class="c-card__meta"><time datetime="2015-06-04T20:32">June 4, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/videochat-in-terminal-8/#post-comments" data-disqus-identifier="877" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/avfoundation/">avfoundation</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/simple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24/" class="invert">Simple OSX bi-directional video chat using ffmpeg, ffplay and wowza</a></h3></header><p class="c-card__text">In this blogpost I will try to present how to set up a very simple video chat application for 2 users. I will call them Chris and John for simplicity. In short, each of them will publish the video and&hellip;</p><footer class="c-card__meta"><time datetime="2015-06-01T08:26">June 1, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/simple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24/#post-comments" data-disqus-identifier="869" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/artificial-intelligence-2/">artificial intelligence</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/intelligent-content-streaming-engine-icse-part-1-introduction-51/" class="invert">Intelligent Content Streaming Engine (ICSE) - Part 1 / Introduction</a></h3></header><p class="c-card__text">Statements“Intelligence is an ability for slow forgetting” “Lazy neuron, great intelligence” “The environment and the Viewer place in that environment is the key player of the prediction game and is the only true and correct point of view for personalised&hellip;</p><footer class="c-card__meta"><time datetime="2015-05-04T20:40">May 4, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/intelligent-content-streaming-engine-icse-part-1-introduction-51/#post-comments" data-disqus-identifier="865" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/devops-2/">devops</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/extending-puppetmaster-module-with-passenger-7/" class="invert">Extending Puppetmaster module with Passenger</a></h3></header><p class="c-card__text">If you manage large farm of servers then most probably you experienced performance problems time to time. To solve puppetmaster problems with handling many of concurrent SSL connections the best solution is switch from WEBrick to Apache2 as gateway for&hellip;</p><footer class="c-card__meta"><time datetime="2014-03-20T16:02">March 20, 2014</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/extending-puppetmaster-module-with-passenger-7/#post-comments" data-disqus-identifier="842" class="invert" rel="nofollow">0</a></div></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://twitter.com/_krislab" aria-label="Twitter" class="twitter"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/_krislab" aria-label="Instagram" class="instagram"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" aria-label="LinkedIn" class="linkedin"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">&copy; 2020 Krzysztof Stasiak</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://blog.kris-lab.com/assets/js/scripts.min.js?v=8b3e67b51e8c7a7d51b33f4a94ae4287"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script><script id="dsq-count-scr" src="https://blog-kris-lab-com.disqus.com/count.js" async></script></body></html>