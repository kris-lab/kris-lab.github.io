<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MongoDB cluster automation and orchestration by Puppet and Pulsar - Chris Stasiak</title><meta name="description" content="Almost every software developer could say a few words about MongoDB. We could say scalability and replication out of the&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://blog.kris-lab.com/mongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11.html"><link rel="alternate" type="application/atom+xml" href="https://blog.kris-lab.com/feed.xml"><link rel="alternate" type="application/json" href="https://blog.kris-lab.com/feed.json"><meta property="og:title" content="MongoDB cluster automation and orchestration by Puppet and Pulsar"><meta property="og:site_name" content="Chris Stasiak"><meta property="og:description" content="Almost every software developer could say a few words about MongoDB. We could say scalability and replication out of the&hellip;"><meta property="og:url" content="https://blog.kris-lab.com/mongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11.html"><meta property="og:type" content="article"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://blog.kris-lab.com/assets/css/style.css?v=1e8049a2db15bde18056c70a364c486d"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kris-lab.com/mongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11.html"},"headline":"MongoDB cluster automation and orchestration by Puppet and Pulsar","datePublished":"2014-08-10T20:23","dateModified":"2020-08-25T13:04","description":"Almost every software developer could say a few words about MongoDB. We could say scalability and replication out of the&hellip;","author":{"@type":"Person","name":"Chris Stasiak"},"publisher":{"@type":"Organization","name":"Chris Stasiak"}}</script></head><body><header class="header" id="js-header"><a href="https://blog.kris-lab.com/" class="logo">Chris Stasiak</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">[MISSING TRANSLATION]</span></span></button><ul class="navbar__menu"><li class="home-button"><a href="https://blog.kris-lab.com" target="_self">{ home }</a></li><li class="has-submenu"><a href="https://blog.kris-lab.com/" target="_self" aria-haspopup="true">#tagged</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://blog.kris-lab.com/vr/" target="_self">360/3D/VR</a></li><li><a href="https://blog.kris-lab.com/wowza-2/" target="_self">Media</a></li><li><a href="https://blog.kris-lab.com/artificial-intelligence-2/" target="_self">AI/ML/TPU</a></li><li><a href="https://blog.kris-lab.com/devops-2/" target="_self">DevOps</a></li></ul></li><li><a href="https://github.com/kris-lab" target="_blank">GitHub</a></li><li><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" target="_blank">LinkedIn</a></li><li><a href="https://keybase.io/krislab" target="_blank">Keybase</a></li><li><a href="https://twitter.com/_krislab" target="_blank">Twitter</a></li><li><a href="https://blog.kris-lab.com/contact.html" target="_self">Contact</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><form action="https://blog.kris-lab.com/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" aria-label="Search text" placeholder="search..." autofocus="autofocus"> <button class="search__submit">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false" height="18" width="18"><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://blog.kris-lab.com/capistrano/" class="post__maintag">capistrano</a><h1 class="post__title">MongoDB cluster automation and orchestration by Puppet and Pulsar</h1><div class="post__meta"><div class="post__author">By <a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" rel="author" title="Chris Stasiak">Chris Stasiak</a></div><time datetime="2014-08-10T20:23">August 10, 2014</time></div></header><div class="post__inner"><div class="post__entry"><p>Almost every software developer could say a few words about MongoDB. We could say scalability and replication out of the box, easy for clustering... and yes, this is true but to achieve that point there are many things to do!</p><p>I have spent a few weeks researching, learning and developing a set of tools to handle all MongoDB technologies and make it ready for real production so...</p><p>For a last few weeks my company is running mongo cluster based on over than 10 servers with more than 2 independent replicas and still grows. This is basically first technology we use which is built with concept of “distributed computing” in mind. As this kind of technology is sometimes difficult for administration we had to invest a lot of time for experiments to make sure this is secure for our production. A lot of work has been done in case of <strong>automation, orchestration, testing and reporting.</strong> We have large set of tools based on <a href="https://github.com/cargomedia/puppet-packages/tree/master/modules/mongodb/" target="_blank">puppet</a>, pulsar (sorry private repo), <a href="https://github.com/cargomedia/bipbip" target="_blank">bipbip</a> and cloud services like <a href="http://copperegg.com/" target="_blank">Copperegg</a> and <a href="https://mms.mongodb.com/" target="_blank">MMS</a> for cluster backup and restore.</p><p>Our cluster is based on few roles: routers (mongos), shards/replicas (mongod), config servers (mongod) and MMS agents. For easy modeling and scaling we introduced <a href="https://github.com/puppetlabs/hiera" target="_blank">Hiera</a> based description for cluster and member roles (<a href="https://gist.github.com/kris-lab/2991b31064da1353a277" target="_blank">example</a>). Each member of cluster is controlled by puppet which contains built in mongodb logic in case of replicasets and shards. Please have a look on very reach set of tests prepared for <a href="https://github.com/cargomedia/puppet-packages/tree/master/modules/mongodb/spec" target="_blank">MongoDB Puppet Module</a>.</p><p>The <a href="https://github.com/nebulab/pulsar">Pulsar</a> tool which was previously used for many applications deployment in many environments was extended to orchestrate MongoDB cluster. So far it works very well for us. Basic implemented tasks list can be found <a href="https://gist.github.com/kris-lab/2d39c520c101b0e0e359" target="_blank">here</a>. Unfortunately full set of tasks is private now (hope will be public soon as well). There is built it simple logic for testing global health of cluster with <a href="https://gist.github.com/kris-lab/dfb169d5ccafcfb155a7" target="_blank">output</a> useful for e.g. <a href="http://mmonit.com/monit/" target="_blank">monit</a> or tools like <a href="https://github.com/cargomedia/pulsar-rest-api" target="_blank">pulsar-rest-api</a> (in development, ETA end of 2014) which will be able to notify sysadmin team over <a href="https://github.com/github/hubot" target="_blank">hubot</a> and hipchat or e.g. <a href="http://www.pagerduty.com/" target="_blank">pager-duty</a>!</p><p>Resource summary:</p><ul><li><a href="https://github.com/cargomedia/puppet-packages/tree/master/modules/mongodb/" target="_blank">MongoDB Puppet Module</a></li><li><a href="https://github.com/cargomedia/puppet-packages/tree/master/modules/mongodb/spec" target="_blank">tests for puppet mongodb module</a></li><li>example cluster modeling in <a href="https://gist.github.com/kris-lab/2991b31064da1353a277" target="_blank">hiera</a></li><li><a href="https://github.com/cargomedia/pulsar-rest-api" target="_blank">pulsar-rest-api</a> github repo</li><li><a href="https://github.com/cargomedia/bipbip" target="_blank">bipbip</a> monitoring tool for Copperegg</li><li>pulsar task list <a href="https://gist.github.com/kris-lab/2d39c520c101b0e0e359" target="_blank">example</a></li><li>pulsar task for health check <a href="https://gist.github.com/kris-lab/dfb169d5ccafcfb155a7" target="_blank">output</a></li></ul></div><footer><p class="post__last-updated">This article was updated on August 25, 2020</p><div class="post__tags-share"><ul class="post__tag"><li><a href="https://blog.kris-lab.com/capistrano/">capistrano</a></li><li><a href="https://blog.kris-lab.com/clustering/">clustering</a></li><li><a href="https://blog.kris-lab.com/mongodb-2/">mongodb</a></li><li><a href="https://blog.kris-lab.com/orchestration/">orchestration</a></li><li><a href="https://blog.kris-lab.com/pulsar/">pulsar</a></li><li><a href="https://blog.kris-lab.com/puppet-2/">puppet</a></li><li><a href="https://blog.kris-lab.com/replication/">replication</a></li><li><a href="https://blog.kris-lab.com/sharding-2/">sharding</a></li></ul><aside class="post__share"><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.kris-lab.com%2Fmongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11.html&amp;via=%40_krislab&amp;text=MongoDB%20cluster%20automation%20and%20orchestration%20by%20Puppet%20and%20Pulsar" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.kris-lab.com%2Fmongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11.html&amp;title=MongoDB%20cluster%20automation%20and%20orchestration%20by%20Puppet%20and%20Pulsar" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=MongoDB%20cluster%20automation%20and%20orchestration%20by%20Puppet%20and%20Pulsar&amp;url=https%3A%2F%2Fblog.kris-lab.com%2Fmongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11.html" class="js-share buffer" aria-label="Share with Buffer" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#buffer"/></svg></a></aside></div><div class="post__bio author"><div><h3 class="h6 author__name"><a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" title="Chris Stasiak">Chris Stasiak</a></h3></div></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://blog.kris-lab.com/cgroups-for-simple-resources-isolation-and-management-5.html" rel="prev">Previous Post<h3 class="h6">CGroups for simple resources isolation and management</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://blog.kris-lab.com/mongo-mms-api-agent-for-ruby-with-basic-cli-client-14.html" rel="prev">Next Post<h3 class="h6">Mongo MMS API agent for ruby with basic cli client</h3></a></div></nav></footer></div></article></div><div class="post__related"><div class="wrapper"><h3 class="h5">Related posts</h3><div class="l-grid l-grid--4"><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/api/">API</a></div><h2 class="c-card__title"><a href="https://blog.kris-lab.com/pulsar-rest-api-24.html" class="invert">PULSAR REST API</a></h2></header><footer class="c-card__meta"><time datetime="2015-05-21T12:04">May 21, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/pulsar-rest-api-24.html#post-comments" data-disqus-identifier="875" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/auto/">auto</a></div><h2 class="c-card__title"><a href="https://blog.kris-lab.com/infrastructure-deployment-with-puppet-2.html" class="invert">Infrastructure deployment with Puppet</a></h2></header><footer class="c-card__meta"><time datetime="2013-12-23T09:38">December 23, 2013</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/infrastructure-deployment-with-puppet-2.html#post-comments" data-disqus-identifier="859" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/apache2/">apache2</a></div><h2 class="c-card__title"><a href="https://blog.kris-lab.com/extending-puppetmaster-module-with-passenger-7.html" class="invert">Extending Puppetmaster module with Passenger</a></h2></header><footer class="c-card__meta"><time datetime="2014-03-20T15:02">March 20, 2014</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/extending-puppetmaster-module-with-passenger-7.html#post-comments" data-disqus-identifier="842" class="invert" rel="nofollow">0</a></div></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://twitter.com/_krislab" aria-label="Twitter" class="twitter"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/_krislab" aria-label="Instagram" class="instagram"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" aria-label="LinkedIn" class="linkedin"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">&copy; 2020 Powered by Publii Static CMS</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://blog.kris-lab.com/assets/js/scripts.min.js?v=8b3e67b51e8c7a7d51b33f4a94ae4287"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>