<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MongoDB cluster automation and orchestration by Puppet and Pulsar - __Chris_Stasiak__</title><meta name="description" content="Almost every software developer could say a few words about MongoDB. We could say scalability and replication out of the box, easy for clustering... and yes, this is true but to achieve that point there are many things to do!&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://blog.kris-lab.com/mongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11/"><link rel="alternate" type="application/atom+xml" href="https://blog.kris-lab.com/feed.xml"><link rel="alternate" type="application/json" href="https://blog.kris-lab.com/feed.json"><meta property="og:title" content="MongoDB cluster automation and orchestration by Puppet and Pulsar"><meta property="og:site_name" content="__Chris_Stasiak__"><meta property="og:description" content="Almost every software developer could say a few words about MongoDB. We could say scalability and replication out of the box, easy for clustering... and yes, this is true but to achieve that point there are many things to do!&hellip;"><meta property="og:url" content="https://blog.kris-lab.com/mongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@_krislab"><meta name="twitter:title" content="MongoDB cluster automation and orchestration by Puppet and Pulsar"><meta name="twitter:description" content="Almost every software developer could say a few words about MongoDB. We could say scalability and replication out of the box, easy for clustering... and yes, this is true but to achieve that point there are many things to do!&hellip;"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://blog.kris-lab.com/assets/css/style.css?v=942a7248764f7bd78c8eab338e2f678a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kris-lab.com/mongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11/"},"headline":"MongoDB cluster automation and orchestration by Puppet and Pulsar","datePublished":"2014-08-10T21:23","dateModified":"2020-08-26T10:49","description":"Almost every software developer could say a few words about MongoDB. We could say scalability and replication out of the box, easy for clustering... and yes, this is true but to achieve that point there are many things to do!&hellip;","author":{"@type":"Person","name":"Chris Stasiak"},"publisher":{"@type":"Organization","name":"Chris Stasiak"}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-176563351-1"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176563351-1');</script></head><body><header class="header" id="js-header"><a href="https://blog.kris-lab.com/" class="logo">__Chris_Stasiak__</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="home-button"><a href="https://blog.kris-lab.com" target="_self">{ home }</a></li><li class="has-submenu"><a href="https://blog.kris-lab.com/" target="_self" aria-haspopup="true">#tagged</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://blog.kris-lab.com/tag/news/" target="_self">News</a></li><li><a href="https://blog.kris-lab.com/tag/devops-2/" target="_self">DevOps</a></li><li><a href="https://blog.kris-lab.com/tag/ffmpeg/" target="_self">Media</a></li><li><a href="https://blog.kris-lab.com/tag/vr/" target="_self">360/3D/VR</a></li><li><a href="https://blog.kris-lab.com/tag/artificial-intelligence-2/" target="_self">AI/ML/TPU</a></li><li><a href="https://blog.kris-lab.com/tag/tools/" target="_self">Tools</a></li></ul></li><li><a href="https://github.com/kris-lab" target="_blank">GitHub</a></li><li><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" target="_blank">LinkedIn</a></li><li><a href="https://keybase.io/krislab" target="_blank">Keybase</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">...</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://twitter.com/_krislab" target="_blank">Twitter</a></li><li><a href="https://www.vivino.com/users/krislab" target="_blank">Vivino</a></li><li><a href="https://you.23andme.com/published/reports/4ce9d90ae16a442590f1d3f8dcfd0eca/?share_id&#x3D;efcd35acba5a4f77" target="_blank">23andMe</a></li></ul></li><li class="line-vertical-separator"><span class="is-separator">|</span></li><li class="has-submenu"><a href="https://blog.kris-lab.com/contact/" target="_self" aria-haspopup="true">About</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://blog.kris-lab.com/contact/" target="_self">Contact</a></li><li><a href="https://blog.kris-lab.com/resume/" target="_self">Resume</a></li><li><a href="https://blog.kris-lab.com/references/" target="_self">References</a></li><li><a href="https://blog.kris-lab.com/gallery/" target="_self">Photos</a></li><li class="line-horizontal-separator"><span class="is-separator">-</span></li><li><a href="https://blog.kris-lab.com/legal/" target="_self">Legal</a></li></ul></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><form action="https://blog.kris-lab.com/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" aria-label="Search input" placeholder="search..." autofocus="autofocus"> <button class="search__submit">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false" height="18" width="18"><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://blog.kris-lab.com/tag/devops-2/" class="post__maintag">devops</a><h1 class="post__title">MongoDB cluster automation and orchestration by Puppet and Pulsar</h1><div class="post__meta"><div class="post__author">By <a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" rel="author" title="Chris Stasiak">Chris Stasiak</a></div><time datetime="2014-08-10T21:23">August 10, 2014</time><div class="post__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/mongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11/#comments" data-disqus-identifier="864" class="invert" rel="nofollow">0</a></div></div></header><div class="post__inner"><div class="post__entry"><p>Almost every software developer could say a few words about MongoDB. We could say scalability and replication out of the box, easy for clustering... and yes, this is true but to achieve that point there are many things to do!</p><p>I have spent a few weeks researching, learning and developing a set of tools to handle all MongoDB technologies and make it ready for real production so...</p><p>For a last few weeks my company is running mongo cluster based on over than 10 servers with more than 2 independent replicas and still grows. This is basically first technology we use which is built with concept of “distributed computing” in mind. As this kind of technology is sometimes difficult for administration we had to invest a lot of time for experiments to make sure this is secure for our production. A lot of work has been done in case of <strong>automation, orchestration, testing and reporting.</strong> We have large set of tools based on <a href="https://github.com/cargomedia/puppet-packages/tree/master/modules/mongodb/" target="_blank" rel="noopener">puppet</a>, pulsar (sorry private repo), <a href="https://github.com/cargomedia/bipbip" target="_blank" rel="noopener">bipbip</a> and cloud services like <a href="http://copperegg.com/" target="_blank" rel="noopener">Copperegg</a> and <a href="https://mms.mongodb.com/" target="_blank" rel="noopener">MMS</a> for cluster backup and restore.</p><p>Our cluster is based on few roles: routers (mongos), shards/replicas (mongod), config servers (mongod) and MMS agents. For easy modeling and scaling we introduced <a href="https://github.com/puppetlabs/hiera" target="_blank" rel="noopener">Hiera</a> based description for cluster and member roles (<a href="https://gist.github.com/kris-lab/2991b31064da1353a277" target="_blank" rel="noopener">example</a>). Each member of cluster is controlled by puppet which contains built in mongodb logic in case of replicasets and shards. Please have a look on very reach set of tests prepared for <a href="https://github.com/cargomedia/puppet-packages/tree/master/modules/mongodb/spec" target="_blank" rel="noopener">MongoDB Puppet Module</a>.</p><p>The <a href="https://github.com/nebulab/pulsar">Pulsar</a> tool which was previously used for many applications deployment in many environments was extended to orchestrate MongoDB cluster. So far it works very well for us. Basic implemented tasks list can be found <a href="https://gist.github.com/kris-lab/2d39c520c101b0e0e359" target="_blank" rel="noopener">here</a>. Unfortunately full set of tasks is private now (hope will be public soon as well). There is built it simple logic for testing global health of cluster with <a href="https://gist.github.com/kris-lab/dfb169d5ccafcfb155a7" target="_blank" rel="noopener">output</a> useful for e.g. <a href="http://mmonit.com/monit/" target="_blank" rel="noopener">monit</a> or tools like <a href="https://github.com/cargomedia/pulsar-rest-api" target="_blank" rel="noopener">pulsar-rest-api</a> (in development, ETA end of 2014) which will be able to notify sysadmin team over <a href="https://github.com/github/hubot" target="_blank" rel="noopener">hubot</a> and hipchat or e.g. <a href="http://www.pagerduty.com/" target="_blank" rel="noopener">pager-duty</a>!</p><p>Resource summary:</p><ul><li><a href="https://github.com/cargomedia/puppet-packages/tree/master/modules/mongodb/" target="_blank" rel="noopener">MongoDB Puppet Module</a></li><li><a href="https://github.com/cargomedia/puppet-packages/tree/master/modules/mongodb/spec" target="_blank" rel="noopener">tests for puppet mongodb module</a></li><li>example cluster modeling in <a href="https://gist.github.com/kris-lab/2991b31064da1353a277" target="_blank" rel="noopener">hiera</a></li><li><a href="https://github.com/cargomedia/pulsar-rest-api" target="_blank" rel="noopener">pulsar-rest-api</a> github repo</li><li><a href="https://github.com/cargomedia/bipbip" target="_blank" rel="noopener">bipbip</a> monitoring tool for Copperegg</li><li>pulsar task list <a href="https://gist.github.com/kris-lab/2d39c520c101b0e0e359" target="_blank" rel="noopener">example</a></li><li>pulsar task for health check <a href="https://gist.github.com/kris-lab/dfb169d5ccafcfb155a7" target="_blank" rel="noopener">output</a></li></ul></div><footer><p class="post__last-updated">This article was updated on August 26, 2020</p><div class="post__tags-share"><ul class="post__tag"><li><a href="https://blog.kris-lab.com/tag/capistrano/">capistrano</a></li><li><a href="https://blog.kris-lab.com/tag/clustering/">clustering</a></li><li><a href="https://blog.kris-lab.com/tag/devops-2/">devops</a></li><li><a href="https://blog.kris-lab.com/tag/mongodb-2/">mongodb</a></li><li><a href="https://blog.kris-lab.com/tag/orchestration/">orchestration</a></li><li><a href="https://blog.kris-lab.com/tag/pulsar/">pulsar</a></li><li><a href="https://blog.kris-lab.com/tag/puppet-2/">puppet</a></li><li><a href="https://blog.kris-lab.com/tag/replication/">replication</a></li><li><a href="https://blog.kris-lab.com/tag/sharding-2/">sharding</a></li><li><a href="https://blog.kris-lab.com/tag/tools/">tools</a></li></ul><aside class="post__share"><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.kris-lab.com%2Fmongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11%2F&amp;via=%40_krislab&amp;text=MongoDB%20cluster%20automation%20and%20orchestration%20by%20Puppet%20and%20Pulsar" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fblog.kris-lab.com%2Fmongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11%2F&amp;media=undefined&amp;description=MongoDB%20cluster%20automation%20and%20orchestration%20by%20Puppet%20and%20Pulsar" class="js-share pinterest" aria-label="Share with Pinterest" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.kris-lab.com%2Fmongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11%2F&amp;title=MongoDB%20cluster%20automation%20and%20orchestration%20by%20Puppet%20and%20Pulsar" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=MongoDB%20cluster%20automation%20and%20orchestration%20by%20Puppet%20and%20Pulsar&amp;url=https%3A%2F%2Fblog.kris-lab.com%2Fmongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11%2F" class="js-share buffer" aria-label="Share with Buffer" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#buffer"/></svg> </a><a href="https://api.whatsapp.com/send?text=MongoDB%20cluster%20automation%20and%20orchestration%20by%20Puppet%20and%20Pulsar https%3A%2F%2Fblog.kris-lab.com%2Fmongodb-cluster-automation-and-orchestration-by-puppet-and-pulsar-11%2F" class="js-share whatsapp" aria-label="Share with WhatsApp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#whatsapp"/></svg></a></aside></div><div class="post__bio author"><div><h3 class="h6 author__name"><a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" title="Chris Stasiak">Chris Stasiak</a></h3></div></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://blog.kris-lab.com/cgroups-for-simple-resources-isolation-and-management-5/" rel="prev">Previous Post<h3 class="h6">CGroups for simple resources isolation and management</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://blog.kris-lab.com/mongo-mms-api-agent-for-ruby-with-basic-cli-client-14/" rel="prev">Next Post<h3 class="h6">Mongo MMS API agent for ruby with basic cli client</h3></a></div></nav></footer></div></article><div class="comments post__inner" id="comments"><h3 class="h5">Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                    this.page.url = '';
            		this.page.identifier = '';
                };
            
                var disqus_loaded = false;
            
                function publiiLoadDisqus() {
                    if(disqus_loaded) {
                        return false;
                    }
            
                    var top = document.getElementById('disqus_thread').offsetTop;
            
                    if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                        disqus_loaded = true;
            
                        (function () {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://blog-kris-lab-com.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    }
                }
            
                publiiLoadDisqus();
            
                window.onscroll = function() {
                    publiiLoadDisqus();
                };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="post__related"><div class="wrapper"><h2 class="h5">Related posts</h2><div class="l-grid l-grid--4"><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/devops-2/">devops</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/pulsar-rest-api-24/" class="invert">PULSAR REST API</a></h3></header><p class="c-card__text">Why? If you work in scale, If you manage multiple application in multiple environments, If you automate any tasks using Capistrano then try a handy solutions which will improve and extend your workbench. Real-life scenario There are many automated tasks&hellip;</p><footer class="c-card__meta"><time datetime="2015-05-21T13:04">May 21, 2015</time></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/auto/">auto</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/infrastructure-deployment-with-puppet-2/" class="invert">Infrastructure deployment with Puppet</a></h3></header><p class="c-card__text">After few months of hard work with new approach to infrastructure deployment I can say that the choice of using Puppet was very good. We reached our goals like: If you are interested in puppet please have a look on open&hellip;</p><footer class="c-card__meta"><time datetime="2013-12-23T10:38">December 23, 2013</time></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/devops-2/">devops</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/extending-puppetmaster-module-with-passenger-7/" class="invert">Extending Puppetmaster module with Passenger</a></h3></header><p class="c-card__text">If you manage large farm of servers then most probably you experienced performance problems time to time. To solve puppetmaster problems with handling many of concurrent SSL connections the best solution is switch from WEBrick to Apache2 as gateway for&hellip;</p><footer class="c-card__meta"><time datetime="2014-03-20T16:02">March 20, 2014</time></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/devops-2/">devops</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/infrastructure-deployment-with-puppet/" class="invert">Infrastructure deployment with Puppet</a></h3></header><p class="c-card__text">After few months of hard work with new approach to infrastructure deployment I can say that the choice of using Puppet was very good. We reached our goals like: If you are interested in puppet please have a look on open&hellip;</p><footer class="c-card__meta"><time datetime="2015-05-25T22:45">May 25, 2015</time></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://twitter.com/_krislab" aria-label="Twitter" class="twitter"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/_krislab" aria-label="Instagram" class="instagram"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" aria-label="LinkedIn" class="linkedin"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">&copy; 2020 Krzysztof Stasiak</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://blog.kris-lab.com/assets/js/scripts.min.js?v=8b3e67b51e8c7a7d51b33f4a94ae4287"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script><script id="dsq-count-scr" src="https://blog-kris-lab-com.disqus.com/count.js" async></script></body></html>