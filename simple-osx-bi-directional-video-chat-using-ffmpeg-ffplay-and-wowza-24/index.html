<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Simple OSX bi-directional video chat using ffmpeg, ffplay and wowza - Chris Stasiak</title><meta name="description" content="In this blogpost I will try to present how to set up a very simple video chat application for 2&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://blog.kris-lab.com/simple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24/"><link rel="alternate" type="application/atom+xml" href="https://blog.kris-lab.com/feed.xml"><link rel="alternate" type="application/json" href="https://blog.kris-lab.com/feed.json"><meta property="og:title" content="Simple OSX bi-directional video chat using ffmpeg, ffplay and wowza"><meta property="og:site_name" content="Chris Stasiak"><meta property="og:description" content="In this blogpost I will try to present how to set up a very simple video chat application for 2&hellip;"><meta property="og:url" content="https://blog.kris-lab.com/simple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@_krislab"><meta name="twitter:title" content="Simple OSX bi-directional video chat using ffmpeg, ffplay and wowza"><meta name="twitter:description" content="In this blogpost I will try to present how to set up a very simple video chat application for 2&hellip;"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://blog.kris-lab.com/assets/css/style.css?v=942a7248764f7bd78c8eab338e2f678a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kris-lab.com/simple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24/"},"headline":"Simple OSX bi-directional video chat using ffmpeg, ffplay and wowza","datePublished":"2015-06-01T08:26","dateModified":"2020-08-25T14:04","description":"In this blogpost I will try to present how to set up a very simple video chat application for 2&hellip;","author":{"@type":"Person","name":"Chris Stasiak"},"publisher":{"@type":"Organization","name":"Chris Stasiak"}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-176563351-1"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176563351-1');</script></head><body><header class="header" id="js-header"><a href="https://blog.kris-lab.com/" class="logo">Chris Stasiak</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="home-button"><a href="https://blog.kris-lab.com" target="_self">{ home }</a></li><li class="has-submenu"><a href="https://blog.kris-lab.com/" target="_self" aria-haspopup="true">#tagged</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://blog.kris-lab.com/tag/news/" target="_self">News</a></li><li><a href="https://blog.kris-lab.com/tag/devops-2/" target="_self">DevOps</a></li><li><a href="https://blog.kris-lab.com/tag/ffmpeg/" target="_self">Media</a></li><li><a href="https://blog.kris-lab.com/tag/vr/" target="_self">360/3D/VR</a></li><li><a href="https://blog.kris-lab.com/tag/artificial-intelligence-2/" target="_self">AI/ML/TPU</a></li></ul></li><li><a href="https://github.com/kris-lab" target="_blank">GitHub</a></li><li><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" target="_blank">LinkedIn</a></li><li><a href="https://keybase.io/krislab" target="_blank">Keybase</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">...</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://twitter.com/_krislab" target="_blank">Twitter</a></li><li><a href="https://www.vivino.com/users/krislab" target="_blank">Vivino</a></li><li><a href="https://you.23andme.com/published/reports/4ce9d90ae16a442590f1d3f8dcfd0eca/?share_id&#x3D;efcd35acba5a4f77" target="_blank">23andMe</a></li></ul></li><li class="line-vertical-separator"><span class="is-separator">|</span></li><li class="has-submenu"><a href="https://blog.kris-lab.com/contact/" target="_self" aria-haspopup="true">About</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://blog.kris-lab.com/contact/" target="_self">Contact</a></li><li><a href="https://blog.kris-lab.com/resume/" target="_self">Resume</a></li><li><a href="https://blog.kris-lab.com/references/" target="_self">References</a></li><li><a href="https://blog.kris-lab.com/gallery/" target="_self">Gallery</a></li><li class="line-horizontal-separator"><span class="is-separator">-</span></li><li><a href="https://blog.kris-lab.com/legal/" target="_self">Legal</a></li></ul></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><form action="https://blog.kris-lab.com/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" aria-label="Search input" placeholder="search..." autofocus="autofocus"> <button class="search__submit">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false" height="18" width="18"><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://blog.kris-lab.com/tag/avfoundation/" class="post__maintag">avfoundation</a><h1 class="post__title">Simple OSX bi-directional video chat using ffmpeg, ffplay and wowza</h1><div class="post__meta"><div class="post__author">By <a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" rel="author" title="Chris Stasiak">Chris Stasiak</a></div><time datetime="2015-06-01T08:26">June 1, 2015</time><div class="post__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/simple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24/#comments" data-disqus-identifier="869" class="invert" rel="nofollow">0</a></div></div></header><div class="post__inner"><div class="post__entry"><p>In this blogpost I will try to present how to set up a very simple video chat application for 2 users. I will call them Chris and John for simplicity. In short, each of them will publish the video and audio. Other side will subscribe to video and audio of the publisher. For instance, Chris will publish video/audio and John will subscribe for it. If both John and Chris will publish/subscribe we achieve "video chat" connection.</p><p>For simplicity I will describe the LAN (local network) solution. However it is fully scalable on the entire web.</p><p><img loading="lazy" alt="" src="https://blog.kris-lab.com/media/posts/869/L4S2Xpgc-RY2g5MWP-xCUstlqJRtnvJJqoMJJ1ySHwnnCXpZweYuafpiH0ewcn90lOsQQ3Sx1hJ7dnYIk3L2xXhCSXYmkOBxzFVaDakNIYxzKgglOkVBH-1vNt5ACT1gtIAQhj0" width="875px;" height="229px;"></p><p><strong>ffmpeg</strong></p><p>OSX requires installation of ffmpeg. You can do it easily with <a href="http://brew.sh/" target="_blank">brew</a>.</p><pre>brew install ffmpeg --with-fdk-aac --with-ffplay --with-freetype --with-frei0r --with-libass --with-libvo-aacenc --with-libvorbis --with-libvpx --with-opencore-amr --with-openjpeg --with-opus --with-rtmpdump --with-schroedinger --with-speex --with-theora --with-tools</pre><p><strong>Media server</strong></p><p>In that example I will use Wowza for simplicity. However in my private test I have used also <strong>ffserver </strong>which requires a bit more configuration and complexity.</p><h4><strong>Wowza</strong></h4><p>Wowza Streaming Engine is much better solution than ffserver in that case. It will work almost out of the box. However it introduces more latency even in "low latency" mode.</p><p>To install the Wowza please use that resource:</p><ul><li><a title="wowza installation" href="http://www.wowza.com/forums/content.php?217-How-to-install-and-configure-Wowza-Streaming-Engine#startMacService">http://www.wowza.com/forums/content.php?217-How-to-install-and-configure-Wowza-Streaming-Engine</a></li></ul><p>The application called "live" is created by default. For my test I did some small changes by disabling the  RTMP authentication. You can login to Wowza Streaming Engine Manager at "localhost:8088/enginemanager" by default using root/root as credentials. Switch to applications section to the "live" application and change the <a href="http://www.wowza.com/forums/content.php?449-How-to-enable-username-password-authentication-for-RTMP-and-RTSP-publishing" target="_blank">Incoming Security Policy</a> for "Open". Also please edit the "live" application setting and mark "low latency" mode. Then simply restart wowza using UI button and that's it! You are ready to go...</p><p><strong>Chat clients</strong></p><p>Discovering of local hardware for video and audio on Mac OS</p><pre>ffmpeg -f avfoundation -list_devices true -i ""</pre><pre>[AVFoundation input device @ 0x7f88b0422800] AVFoundation video devices:
[AVFoundation input device @ 0x7f88b0422800] [0] FaceTime HD Camera
[AVFoundation input device @ 0x7f88b0422800] [1] Capture screen 0
[AVFoundation input device @ 0x7f88b0422800] AVFoundation audio devices:
[AVFoundation input device @ 0x7f88b0422800] [0] Built-in Microphone</pre><p>Local auto test of video/audio source and player</p><pre>ffmpeg -f avfoundation -i "default":"default" -vcodec libx264 -acodec ac3 -preset ultrafast -tune zerolatency -f nut pipe:1 | ffplay pipe:0</pre><address>(In my case there is around 0.6-0.8 second latency when piping video to the player. It happens because of shell standard input/output buffer. By default it is 16384 bytes. Documentation says it can switch to 65336 capacity if needed. However this is serious bottleneck between the source of data and the player)</address><p>The screenshot below shows the camera input in the FaceTime (right side) and the same camera input piped (shell) by ffmpeg and rendered by ffplayer (left side).</p><address><img loading="lazy" alt="" src="https://blog.kris-lab.com/media/posts/869/D7BmCDkXFUBgA68RMCv4naxUI1jwI3zORaT2BIP2wVCRi4cdyQXWkAdRLYMC6BwGLFbljdVGvAgRrKXjbAJc0nX02yYWC6Lxn90u0jxa2HQs_nA4tLxIgpKb2UwTxQm5yRvirtU" width="841px;" height="460px;"></address><p>Preparing for publishing and streaming</p><pre># IP address of computer with installed wowza server
export RTMP_SERVER=example.com:1935

# application name. by default there is "live" app created
export RTMP_APP=live

# users for video chat connection
# please switch source/destination for opposite end-points
export RTMP_STREAM_ME=chris
export RTMP_STREAM_FRIEND=john</pre><p>Publishing video and audio as Chris/John</p><pre>ffmpeg -f avfoundation -i "default":"default" -pix_fmt yuv420p -s 284x164 -vcodec libx264 -preset ultrafast -tune zerolatency -f flv rtmp://$RTMP_SERVER/$RTMP_APP/$RTMP_STREAM_ME</pre><p>Subscribing to Chris/John's video and audio</p><pre>ffplay -fflags nobuffer rtmp://$RTMP_SERVER/$RTMP_APP/$RTMP_STREAM_FRIEND</pre><p><strong>Summary</strong></p><p>This is pretty much all you have to do to start full video chat connection. The quality is not always the best due to latency problem. As we do not implement the "echo suppression and cancellation", "noise reduction" etc on the server and the client end-point there is high chance that you will experience bad quality connection if the network latency increases.</p><p>Anyway I hope this is somehow helpful for people starting with live video streaming...</p><p>Please ask in comments section if you need any help or more detailed explanation.</p><p>Have fun!</p></div><footer><p class="post__last-updated">This article was updated on August 25, 2020</p><div class="post__tags-share"><ul class="post__tag"><li><a href="https://blog.kris-lab.com/tag/avfoundation/">avfoundation</a></li><li><a href="https://blog.kris-lab.com/tag/benchmark/">benchmark</a></li><li><a href="https://blog.kris-lab.com/tag/brew/">brew</a></li><li><a href="https://blog.kris-lab.com/tag/chat/">chat</a></li><li><a href="https://blog.kris-lab.com/tag/ffmpeg/">ffmpeg</a></li><li><a href="https://blog.kris-lab.com/tag/ffplay/">ffplay</a></li><li><a href="https://blog.kris-lab.com/tag/ffserver/">ffserver</a></li><li><a href="https://blog.kris-lab.com/tag/hacking/">hacking</a></li><li><a href="https://blog.kris-lab.com/tag/live/">LIVE</a></li><li><a href="https://blog.kris-lab.com/tag/low-latency/">low latency</a></li><li><a href="https://blog.kris-lab.com/tag/osx/">osx</a></li><li><a href="https://blog.kris-lab.com/tag/video-chat/">video chat</a></li><li><a href="https://blog.kris-lab.com/tag/wowza-2/">wowza</a></li></ul><aside class="post__share"><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.kris-lab.com%2Fsimple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24%2F&amp;via=%40_krislab&amp;text=Simple%20OSX%20bi-directional%20video%20chat%20using%20ffmpeg%2C%20ffplay%20and%20wowza" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.kris-lab.com%2Fsimple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24%2F&amp;title=Simple%20OSX%20bi-directional%20video%20chat%20using%20ffmpeg%2C%20ffplay%20and%20wowza" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=Simple%20OSX%20bi-directional%20video%20chat%20using%20ffmpeg%2C%20ffplay%20and%20wowza&amp;url=https%3A%2F%2Fblog.kris-lab.com%2Fsimple-osx-bi-directional-video-chat-using-ffmpeg-ffplay-and-wowza-24%2F" class="js-share buffer" aria-label="Share with Buffer" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#buffer"/></svg></a></aside></div><div class="post__bio author"><div><h3 class="h6 author__name"><a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" title="Chris Stasiak">Chris Stasiak</a></h3></div></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://blog.kris-lab.com/wowza-powered-by-nvidia-gpu-on-aws-5/" rel="prev">Previous Post<h3 class="h6">Wowza powered by Nvidia GPU on AWS</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://blog.kris-lab.com/osx-low-latency-ffmpeg-plublisher-with-ffplay-subscriber-via-wowza-streaming-engine-3/" rel="prev">Next Post<h3 class="h6">OSX low latency ffmpeg publisher with ffplay subscriber via wowza streaming engine</h3></a></div></nav></footer></div></article><div class="comments post__inner" id="comments"><h3 class="h5">Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                    this.page.url = '';
            		this.page.identifier = '';
                };
            
                var disqus_loaded = false;
            
                function publiiLoadDisqus() {
                    if(disqus_loaded) {
                        return false;
                    }
            
                    var top = document.getElementById('disqus_thread').offsetTop;
            
                    if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                        disqus_loaded = true;
            
                        (function () {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://blog-kris-lab-com.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    }
                }
            
                publiiLoadDisqus();
            
                window.onscroll = function() {
                    publiiLoadDisqus();
                };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="post__related"><div class="wrapper"><h2 class="h5">Related posts</h2><div class="l-grid l-grid--4"><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/audio-2/">audio</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24/" class="invert">Video streaming benchmark with ffmpeg, ffserver, wowza...</a></h3></header><footer class="c-card__meta"><time datetime="2015-05-26T20:22">May 26, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/video-streaming-benchmark-with-ffmpeg-ffserver-wowza-24/#post-comments" data-disqus-identifier="878" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/news/">news</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/videochat-in-terminal-8/" class="invert">VideoChat in Terminal</a></h3></header><footer class="c-card__meta"><time datetime="2015-06-04T20:32">June 4, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/videochat-in-terminal-8/#post-comments" data-disqus-identifier="877" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/benchmark/">benchmark</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/wowza-powered-by-m3-and-g2-instances-on-aws-31/" class="invert">Wowza powered by M3 and G2 instances on AWS ?</a></h3></header><footer class="c-card__meta"><time datetime="2015-05-29T15:01">May 29, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/wowza-powered-by-m3-and-g2-instances-on-aws-31/#post-comments" data-disqus-identifier="870" class="invert" rel="nofollow">0</a></div></footer></div></article><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/tag/devops-2/">devops</a></div><h3 class="c-card__title"><a href="https://blog.kris-lab.com/wowza-powered-by-nvidia-gpu-on-aws-5/" class="invert">Wowza powered by Nvidia GPU on AWS</a></h3></header><footer class="c-card__meta"><time datetime="2015-05-31T15:22">May 31, 2015</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/wowza-powered-by-nvidia-gpu-on-aws-5/#post-comments" data-disqus-identifier="720" class="invert" rel="nofollow">0</a></div></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://twitter.com/_krislab" aria-label="Twitter" class="twitter"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/_krislab" aria-label="Instagram" class="instagram"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" aria-label="LinkedIn" class="linkedin"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">&copy; 2020 Krzysztof Stasiak</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://blog.kris-lab.com/assets/js/scripts.min.js?v=8b3e67b51e8c7a7d51b33f4a94ae4287"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script><script id="dsq-count-scr" src="https://blog-kris-lab-com.disqus.com/count.js" async></script></body></html>