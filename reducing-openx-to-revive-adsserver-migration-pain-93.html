<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Reducing OpenX to Revive AdsServer migration pain! - Chris Stasiak</title><meta name="description" content="A few weeks ago my team decided to migrate OpenX 2.8.3 run on Debian Squeeze to Revive AdsServer 3.0.3 run&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://blog.kris-lab.com/reducing-openx-to-revive-adsserver-migration-pain-93.html"><link rel="alternate" type="application/atom+xml" href="https://blog.kris-lab.com/feed.xml"><link rel="alternate" type="application/json" href="https://blog.kris-lab.com/feed.json"><meta property="og:title" content="Reducing OpenX to Revive AdsServer migration pain!"><meta property="og:site_name" content="Chris Stasiak"><meta property="og:description" content="A few weeks ago my team decided to migrate OpenX 2.8.3 run on Debian Squeeze to Revive AdsServer 3.0.3 run&hellip;"><meta property="og:url" content="https://blog.kris-lab.com/reducing-openx-to-revive-adsserver-migration-pain-93.html"><meta property="og:type" content="article"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://blog.kris-lab.com/assets/css/style.css?v=7b5c27b5d3b529a3ef283d7528c6afce"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kris-lab.com/reducing-openx-to-revive-adsserver-migration-pain-93.html"},"headline":"Reducing OpenX to Revive AdsServer migration pain!","datePublished":"2014-04-06T10:37","dateModified":"2020-08-25T13:04","description":"A few weeks ago my team decided to migrate OpenX 2.8.3 run on Debian Squeeze to Revive AdsServer 3.0.3 run&hellip;","author":{"@type":"Person","name":"Chris Stasiak"},"publisher":{"@type":"Organization","name":"Chris Stasiak"}}</script></head><body><header class="header" id="js-header"><a href="https://blog.kris-lab.com/" class="logo">Chris Stasiak</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">[MISSING TRANSLATION]</span></span></button><ul class="navbar__menu"><li><a href="https://blog.kris-lab.com" target="_self">Home</a></li><li><a href="https://github.com/kris-lab" target="_blank">GitHub</a></li><li><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" target="_blank">LinkedIn</a></li><li><a href="https://keybase.io/krislab" target="_blank">Keybase</a></li><li><a href="https://twitter.com/_krislab" target="_blank">Twitter</a></li><li><a href="https://blog.kris-lab.com/contact.html" target="_self">Contact</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><form action="https://blog.kris-lab.com/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" aria-label="Search text" placeholder="search..." autofocus="autofocus"> <button class="search__submit">Search</button></form></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false" height="18" width="18"><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://blog.kris-lab.com/deployment/" class="post__maintag">deployment</a><h1 class="post__title">Reducing OpenX to Revive AdsServer migration pain!</h1><div class="post__meta"><div class="post__author">By <a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" rel="author" title="Chris Stasiak">Chris Stasiak</a></div><time datetime="2014-04-06T10:37">April 6, 2014</time></div></header><div class="post__inner"><div class="post__entry"><p>A few weeks ago my team decided to migrate <strong>OpenX 2.8.3</strong> run on <strong>Debian Squeeze</strong> to <strong>Revive AdsServer 3.0.3</strong> run on <strong>Debian Wheezy</strong>. I researched a lot and gathered as much info as possible. All preparation took a bit as platform was tested using specs which are part of open source <a href="https://github.com/cargomedia/puppet-packages">puppet-packages</a> deployment modules (done by <a href="https://github.com/cargomedia">us</a>).</p><p>The upgrade process is described very well on <a href="http://www.revive-adserver.com/support/upgrading/">Revive website</a>. They suggest to read manual very carefully! I confirm, please do it and please read very carefully <a href="http://www.revive-adserver.com/support/requirements/">requirements</a> (unfortunately I missed that step)</p><h3>My steps</h3><p>1.  migration to Debian Wheezy using <strong>default</strong> package sources<br>2.  <a href="https://github.com/cargomedia/puppet-packages/tree/master/modules/revive">puppet-packages/revive</a> module has been prepared<br>3.  backup has been done (db, files)<br>4.  upgrade done like in <a href="http://www.revive-adserver.com/support/upgrading/">manual</a> prepared by Revive team but:</p><h4>I experienced some problem during plugins installation and permission mismatch of previous installation folder but finally upgrade wizard confirmed that all finished successfully. Also maintenance tools confirmed that all works good!</h4><p>5.  to make sure all is fine I did reinstall all plugins using <a href="https://github.com/revive-adserver/revive-adserver/tree/master/plugins_repo/release">github master branch</a></p><p>I have to mention here that I had no too much experience as user of OpenX. I could confirm that UI works fine, maintenance test passed, all data exists, ads are delivered to end point.</p><h3>2 weeks later!!!</h3><p>Issue has been reported that <strong>statistics</strong> are not longer available. After 2 days googling, testing, tens of reinstallation I have found many issues. Will describe some of them as maybe it will save someone time in the future.</p><p>Please notice that my server location is '/var/revive' so all examples use it by default.</p><h4>Logs viewing</h4><pre>$ tailf /var/revive/var/debug.log
$ tailf /var/log/php/error.log</pre><p>On that point I have found plenty of PHP errors and no single one in revive log. All PHP errors were related to the wrong file path. Problem was in non existing constant RV_PATH or OX_PATH (previous versions). Below how to fix it if you experience that problem.</p><h4>Some basic errors</h4><p>Because of this issue the statistics cannot be generated as no data about impression, click etc doesn't exist. Each HTTP Request from client to server has finished with errors!</p><pre>$ nano +13 /var/revive/lib/RV.php</pre><p>Change line</p><pre>require RV_PATH . '/lib/pear/PEAR.php'</pre><p>with your server path e.g.</p><pre>require '/var/revive/lib/pear/PEAR.php'</pre><p>This issue should be fixed soon by revive team in next versions...</p><h4>Manual statistics generation</h4><p>On that point there are no errors in log files. Next step is to generate statistics manually. You can do it using:</p><pre>$ php /var/revive/script/maintenance/maintenance.php ads.example.com
Segmentation fault</pre><p>Unfortunately, there is next problem. Some PHP error occurred. Please read below</p><h4>Problem understanding</h4><p>After deeper investigation using <a href="http://www.sourceware.org/gdb/">GDB</a> I have found PHP segmentation problem described by <a href="https://bugs.php.net/bug.php?id=65367">php team</a> and <a href="http://www.revive-adserver.com/blog/whats-new-in-revive-adserver-v3-0-0/">revive team</a>. The only solution is to update PHP but in our case the problem is that we use default sources for our Debian Wheezy (in puppet). It installs PHP 5.4.4 by default (state for date of this post). On this point it is worth to mention that plugins problems during upgrade (described above) are strongly related to PHP bug! As result of this issue some of mysql tables are not created!</p><h4>Reinstallation</h4><p>We have prepared small <a href="https://github.com/cargomedia/puppet-packages/pull/560">update</a> for our puppet revive module which allows to install additional <a href="https://github.com/cargomedia/puppet-packages/blob/master/modules/apt/manifests/source/dotdeb.pp">sources</a> for apt-get package manager.</p><p>What have to be done:<br>- add dotdeb sources e.g. <a href="https://github.com/cargomedia/puppet-packages/blob/master/modules/apt/manifests/source/dotdeb.pp">this</a><br>- apt-get upgrade for example:</p><pre>$ apt-get update
$ apt-get purge php5-cli
$ apt-get purge mysql-server
$ apt-get install php5-cli
$ apt-get install mysql-server</pre><p>- revive installation (please follow revive official documentation or use <a href="https://github.com/cargomedia/puppet-packages/tree/master/modules/revive">puppet-module</a>)<br>- data migration (please follow revive official docu)</p><p><strong>Results: </strong>no errors! manual statistics generation works fine. Please notice that inserts to db/table are done every X mins what can be configured in settings/maintenance panel (by default 60min)</p><h4>Automations</h4><p>Last problem I experienced is related to statistics summarization. It was not done for me automatically. You can find cached data about impressions, clicks etc in <strong>/var/revive/var/cache</strong> but no data in database. You can run time to time this</p><pre>$ php /var/revive/script/maintenance/maintenance.php ads.example.com</pre><p>or add cron job (which makes more sense)</p><pre>$ crontab -e</pre><p>then add</p><pre>10 * * * * /usr/bin/php /var/revive/scripts/maintenance/maintenance.php ads.example.com</pre><p>So now all should works fine and new statistics should appear in db. For me it took up to 60-70min.</p><p>DB tables which is worth to check time to time:<br>- <strong>ox_log_maintenance_statistics</strong> contains info about maintenance activity<br>- <strong>ox_data_summary_ad_hourly</strong> contains summarized info about delivery, clicks etc. for active zones</p><h4>Summary</h4><p>Before any update please check <a href="http://www.revive-adserver.com/support/requirements/">requirements</a> (it is not linked to upgrade manual)</p><pre>- Apache with mod_php or any webserver using FastCGI (nginx, IIS 7+, lighttpd, etc.)
- PHP 5.1.4+, 5.2.x, 5.3.x, 5.4.20+, 5.5.2+
- Required PHP extensions: zlib, pcre, xml, mysql and/or pgsql
- Suggested PHP extensions: curl and/or openssl, gd, any opcode cache extension (opcache, apc, eaccelerator, xcache)</pre></div><footer><p class="post__last-updated">This article was updated on August 25, 2020</p><div class="post__tags-share"><ul class="post__tag"><li><a href="https://blog.kris-lab.com/deployment/">deployment</a></li><li><a href="https://blog.kris-lab.com/mysql-2/">mysql</a></li><li><a href="https://blog.kris-lab.com/openx/">openx</a></li><li><a href="https://blog.kris-lab.com/php/">php</a></li><li><a href="https://blog.kris-lab.com/revive/">revive</a></li><li><a href="https://blog.kris-lab.com/upgrade/">upgrade</a></li><li><a href="https://blog.kris-lab.com/workaround/">workaround</a></li></ul><aside class="post__share"><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.kris-lab.com%2Freducing-openx-to-revive-adsserver-migration-pain-93.html&amp;via=%40_krislab&amp;text=Reducing%20OpenX%20to%20Revive%20AdsServer%20migration%20pain!" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.kris-lab.com%2Freducing-openx-to-revive-adsserver-migration-pain-93.html&amp;title=Reducing%20OpenX%20to%20Revive%20AdsServer%20migration%20pain!" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://buffer.com/add?text=Reducing%20OpenX%20to%20Revive%20AdsServer%20migration%20pain!&amp;url=https%3A%2F%2Fblog.kris-lab.com%2Freducing-openx-to-revive-adsserver-migration-pain-93.html" class="js-share buffer" aria-label="Share with Buffer" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#buffer"/></svg></a></aside></div><div class="post__bio author"><div><h3 class="h6 author__name"><a href="https://blog.kris-lab.com/authors/chris-stasiak/" class="invert" title="Chris Stasiak">Chris Stasiak</a></h3></div></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://blog.kris-lab.com/extending-puppetmaster-module-with-passenger-7.html" rel="prev">Previous Post<h3 class="h6">Extending Puppetmaster module with Passenger</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://blog.kris-lab.com/nfs-to-aws-s3-migration-15.html" rel="prev">Next Post<h3 class="h6">NFS to AWS S3 migration</h3></a></div></nav></footer></div></article></div><div class="post__related"><div class="wrapper"><h3 class="h5">Related posts</h3><div class="l-grid l-grid--4"><article class="c-card"><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://blog.kris-lab.com/aws/">AWS</a></div><h2 class="c-card__title"><a href="https://blog.kris-lab.com/nfs-to-aws-s3-migration-15.html" class="invert">NFS to AWS S3 migration</a></h2></header><footer class="c-card__meta"><time datetime="2014-04-24T07:41">April 24, 2014</time><div class="c-card__comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#comments"/></svg> <a href="https://blog.kris-lab.com/nfs-to-aws-s3-migration-15.html#post-comments" data-disqus-identifier="867" class="invert" rel="nofollow">0</a></div></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://twitter.com/_krislab" aria-label="Twitter" class="twitter"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.instagram.com/_krislab" aria-label="Instagram" class="instagram"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.linkedin.com/in/krzysztof-chris-stasiak-6261244b/" aria-label="LinkedIn" class="linkedin"><svg><use xlink:href="https://blog.kris-lab.com/assets/svg/svg-map.svg#linkedin"/></svg></a></div><div class="footer__copyright">&copy; 2020 Powered by Publii Static CMS</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://blog.kris-lab.com/assets/js/scripts.min.js?v=8b3e67b51e8c7a7d51b33f4a94ae4287"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>